<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Operational Modernization - WebSphere Application Modernization</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../stylesheets/klp.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Operational Modernization";
    var mkdocs_page_input_path = "OperationalModernization\\index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> WebSphere Application Modernization</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../environments-setup/">Reserve lab environment or workshop</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../basic-labs/">Basic Containerization & App Mod Tools Labs</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../appmod-labs/">App Modernization Labs</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../devops-labs/">DevOps Labs</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Resources</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../OpenshiftConcepts/">Openshift Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../WebSphereCloud/">Moving WebSphere applications to Cloud</a>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">Additional Resources</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">WebSphere Application Modernization</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Operational Modernization</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="operational-modernization">Operational Modernization</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#analysis">Analysis</a> (Hands-on)</li>
<li><a href="#build">Build</a> (Hands-on)</li>
<li><a href="#deploy">Deploy without operator</a> (Hands-on)</li>
<li><a href="#access-the-application">Access the Application without operator</a> (Hands-on)</li>
<li><a href="#deploy-rco">Alternate Deployment via Runtime Component Operator</a> (Hands-on)</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#next">Next</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="introduction">Introduction</h2>
<p><strong>Operational modernization</strong> gives an operations team the opportunity to embrace modern operations best practices without putting change requirements on the development team. 
Modernizing from WebSphere Network Deployment (ND) to the <strong>traditional WebSphere Application Server Base V9 runtime</strong> in a container allows the application to be moved to the cloud without code changes.</p>
<p><strong>This type of modernization shouldn't require any code changes</strong> and can be driven by the operations team. <strong>This path gets the application in to a container with the least amount of effort but doesn't modernize the application or the runtime.</strong></p>
<p>In this lab, we'll use <strong>Customer Order Services</strong> application as an example. In order to modernize, the application will go through <strong>analysis</strong>, <strong>build</strong> and <strong>deploy</strong> phases. Click <a href="extras/application/">here</a> and get to know the application, its architecture and components.</p>
<p><a name="Login_VM"> </a></p>
<h2 id="login-to-the-vm">Login to the VM</h2>
<ol>
<li>If the VM is not already started, start it by clicking the Play button.</li>
</ol>
<p><img alt="start VM" src="extras/images/loginvm1.png" /></p>
<ol>
<li>After the VM is started, click the <strong>desktop</strong> VM to access it.</li>
</ol>
<p><img alt="desktop VM" src="extras/images/loginvm2.png" /></p>
<ol>
<li>Login with <strong>ibmuser</strong> ID.</li>
<li>Click on the <strong>ibmuser</strong> icon on the Ubuntu screen.</li>
<li>
<p>When prompted for the password for <strong>ibmuser</strong>, enter "<strong>engageibm</strong>" as the password: \
     Password: <strong>engageibm</strong></p>
<p><img alt="login VM" src="extras/images/loginvm3.png" /></p>
</li>
<li>
<p>Resize the Skytap environment window for a larger viewing area while doing the lab. From the Skytap menu bar, click on the "<strong>Fit to Size</strong>" icon. This will enlarge the viewing area to fit the size of your browser window. </p>
</li>
</ol>
<p><img alt="fit to size icon" src="extras/images/loginvm4.png" /></p>
<p><a name="analysis"></a></p>
<h2 id="analysis-hands-on">Analysis (Hands-on)</h2>
<p>IBM Cloud Transformation Advisor can be used to analyze the Customer Order Service Application running in the WebSphere ND environment. The Transformation Advisor helps you to analyze your on-premises workloads for modernization. It determines the complexity of your applications, estimates a development cost to perform the move to the cloud, and recommends the best target environment. </p>
<p>The steps needed to analyze the existing Customer Order Services application are:
1. Open a Firefox browser window from within the VM. 
    <img alt="firefox" src="extras/images/analysis1.png" /></p>
<ol>
<li>
<p>Click on the <strong>openshift console</strong> bookmark in the top left and log in with the <strong>htpasswd</strong> option.</p>
<p><img alt="openshift console" src="extras/images/analysis2.png" /></p>
</li>
<li>
<p>Log in to the OpenShift account using the following credentials:</p>
<ul>
<li>Username: <strong>ibmadmin</strong></li>
<li>Password: <strong>engageibm</strong></li>
</ul>
<p><img alt="login" src="extras/images/analysis3.png" /></p>
</li>
<li>
<p>From the Red Hat OpenShift Container Platform console, go to the <strong>Networking</strong> tab and click on <strong>Routes</strong>. Ensure that you are in the <strong>ta</strong> project by using the project drop down and click on the Location URL next to <strong>ta-ui-route</strong>.</p>
<p><img alt="ta" src="extras/images/analysis4.png" /></p>
</li>
<li>
<p>This will open the Transformation Advisor user interface. Click <strong>Create new</strong> under <strong>Workspaces</strong> to create a new workspace. </p>
<p><img alt="TA starting page" src="extras/images/ta-create-collection.png" /></p>
</li>
<li>
<p>Name it <strong>OperationalModernization</strong> and click <strong>Next</strong>. </p>
<p><img alt="Choose workspace name" src="extras/images/ta-name-workspace.png" /></p>
<p>You'll be asked to create a new collection to store the data collected from the <strong>Customer Order Services</strong> application. Name it <strong>CustomerOrderServices</strong>. Click <strong>Create</strong>. </p>
<p><img alt="Choose collection name" src="extras/images/ta-name-collection.png" /></p>
</li>
<li>
<p>To provide data and receive recommendations, you can either download and execute the <strong>Data Collector</strong> against an existing WebSphere environment or upload an existing data collection archive. The archive has already been created for you and the resulting data is stored <a href="resources/datacollection.zip">here</a>. </p>
<p><img alt="TA no recommendations available screen" src="extras/images/ta-upload.png" /></p>
<p>Upload the results of the data collection (the <a href="resources/datacollection.zip"><strong>datacollector.zip</strong></a> file) to IBM Cloud Transformation Advisor.</p>
<p><img alt="TA upload collection screen" src="extras/images/ta-upload-datacollection-dialog.png" /></p>
</li>
<li>
<p>When the upload is complete, you will see a list of applications analyzed from the source environment. At the top of the page, you can see the source environment and the target environment settings.  </p>
<p><img alt="TA recommendations screen for the data collection" src="extras/images/ta-migration-target.png" /></p>
<p>Under the <strong>Migration target</strong> field, click the down arrow and select <strong>Compatible runtimes</strong>. This will show you an entry for each application for each compatible destination runtime you can migrate it to.</p>
<p><img alt="TA choosing compatible runtimes" src="extras/images/ta-compatible-runtimes.png" /></p>
</li>
<li>
<p>Click the <strong>CustomerOrderServicesApp.ear</strong> application with the <strong>WebSphere traditional</strong> migration target to open the <strong>Application details page</strong>. </p>
<p><img alt="TA choosing CustomerOrderServices tWAS target" src="extras/images/ta-cos-twas.png" /></p>
</li>
<li>
<p>Look over the migration analysis. You can view a summary of the complexity of migrating this application to this target, see detailed information about issues, and view additional reports about the application. In summary, no code changes are required to move this application to the traditional WebSphere Base v9 runtime, so it is a good candidate to proceed with the operational modernization.</p>
<p><img alt="TA detailed analysis for CustomerOrderServices" src="extras/images/ta-detailed-analysis.png" /></p>
</li>
<li>
<p>Click on <strong>View migration plan</strong> in the top right corner of the page. </p>
<p><img alt="TA migration plan button" src="extras/images/ta-migration-bundle-button.png" /></p>
<p>This page will help you assemble an archive containing:
- your application's source or binary files (you upload these here or specify Maven coordinates to download them)
- any required drivers or libraries (you upload these here or specify Maven coordinates to download them)
- the wsadmin scripts needed to configure your application and its resources (generated by Transformation Advisor and automatically included)
- the deployment artifacts needed to create the container image and deploy the application to OCP (generated by Transformation Advisor and automatically included)</p>
<p><img alt="TA migration plan page" src="extras/images/ta-migration-bundle.png" /></p>
</li>
</ol>
<blockquote>
<p>NOTE: These artifacts have already been provided for you as part of the lab files, so you don't need to download the migration plan. However, you can do so if you wish to look around at the files. These files can also be sent to a Git repository by Transformation Advisor.</p>
</blockquote>
<p>For a more detailed walkthrough of the Transformation Advisor process, see <a href="extras/WAS-analyze/">this document</a>. </p>
<p><a name="build"></a></p>
<h2 id="build-hands-on">Build (Hands-on)</h2>
<p>In this section, you'll learn how to build a Docker image for Customer Order Services application running on traditional WebSphere Base v9.</p>
<p>Building this image could take around ~8 minutes. So, let's kick that process off before explaining what you did. The image should be built by the time you complete this section.</p>
<ol>
<li>
<p>Open a new terminal window from the VM desktop.</p>
<p><img alt="terminal window" src="extras/images/build1.png" /></p>
</li>
<li>
<p>Login to OpenShift CLI with the <code>oc login</code> command from the web terminal. When prompted for the username and password, enter the following login credentials:</p>
<ul>
<li>Username: <strong>ibmadmin</strong></li>
<li>Password: <strong>engageibm</strong></li>
</ul>
<p><img alt="oc login" src="extras/images/build2.png" /></p>
</li>
<li>
<p>If you have not yet cloned the GitHub repo with the lab artifacts, run the following command on your terminal:
    <pre class="highlight"><code>git clone https://github.com/IBM/openshift-workshop-was.git</code></pre></p>
</li>
<li>
<p>Change directory to where this lab is located:
    <pre class="highlight"><code>cd openshift-workshop-was/labs/Openshift/OperationalModernization
ls</code></pre></p>
</li>
<li>
<p>Run the following command to create a new project named <code>apps-was</code> in OpenShift. </p>
<pre class="highlight"><code>oc new-project apps-was</code></pre>

<p>Example output:
 <pre class="highlight"><code>Now using project "apps-was" on server "https://c115-e.us-south.containers.cloud.ibm.com:32661".
. . .</code></pre></p>
</li>
<li>
<p>Run the following command to start building the image. Make sure to copy the entire command, including the <code>"."</code> at the end (which indicates current directory). 
    <pre class="highlight"><code>docker build --tag default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was .</code></pre></p>
</li>
</ol>
<h3 id="build-image-hands-on">Build image (Hands-on)</h3>
<ol>
<li>Review the command you ran earlier:</li>
</ol>
<pre class="highlight"><code>docker build --tag default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was .</code></pre>

<ul>
<li>It instructs docker to build the image following the instructions in the Dockerfile in current directory (indicated by the <code>"."</code> at the end).</li>
<li>A specific name to tag the built image is also specified after <code>--tag</code>.</li>
<li>The value <code>default-route-openshift-image-registry.apps.demo.ibmdte.net</code> in the tag is the default address of the internal image registry provided by OpenShift. </li>
<li>Image registry is a content server that can store and serve container images. </li>
<li>The registry is accessible within the cluster via its exposed <code>Service</code>. </li>
<li>The format of a Service address: <em>name</em>.<em>namespace</em>.<em>svc</em>. </li>
<li>In this case, the image registry is named <code>image-registry</code> and it's in namespace <code>openshift-image-registry</code>.</li>
<li>
<p>Later when we push the image to OpenShift's internal image registry, we'll refer to the image by the same values.</p>
</li>
<li>
<p>You should see the following message if the image was successfully built. Please wait if it's still building.</p>
</li>
</ul>
<pre class="highlight"><code>Successfully built aa6babbb5ce9
Successfully tagged default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was:latest</code></pre>

<ol>
<li>Validate that image is in the repository by running the command:</li>
</ol>
<pre class="highlight"><code>docker images</code></pre>

<ul>
<li>
<p>Notice that the base image, websphere-traditional, is also listed. It was pulled as the first step of building application image.</p>
<p>Example output:
 <pre class="highlight"><code>REPOSITORY                                                             TAG                 IMAGE ID            CREATED             SIZE
default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was      latest              9394150a5a15        10 minutes ago      2.05GB
ibmcom/websphere-traditional                                           latest              898f9fd79b36        12 minutes ago      1.86GB</code></pre></p>
</li>
<li>
<p>Note that <code>docker images</code> only lists those images that are cached locally.</p>
</li>
<li>The name of the image also contains the host name where the image is hosted. </li>
<li>If there is no host name, the image is hosted on docker hub. For example, the image <code>ibmcom/websphere-traditional</code> has no host name. It is hosted on docker hub.</li>
<li>The image we just built, <code>default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was</code>, has host name <code>default-route-openshift-image-registry.apps.demo.ibmdte.net</code>. It is to be hosted in the Openshift image registry for your lab cluster.</li>
<li>
<p>If you change an image, or build a new image, the changes are only available locally. You must <code>push</code> the image to propagate the changes to the remote registry.</p>
</li>
<li>
<p>Let's push the image you just built to your OpenShift cluster's built-in image registry. </p>
</li>
<li>
<p>First, login to the image registry by running the following command in the terminal. </p>
<ul>
<li>Note: A session token is obtained from the value of another command <code>oc whoami -t</code> and used as the password to login.</li>
</ul>
<pre class="highlight"><code>docker login -u $(oc whoami) -p $(oc whoami -t) default-route-openshift-image-registry.apps.demo.ibmdte.net</code></pre>

<p>Example output:
 <pre class="highlight"><code>WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded</code></pre></p>
</li>
<li>
<p>Now, push the image into OpenShift cluster's internal image registry, which will take 1-2 minutes:</p>
<pre class="highlight"><code>docker push default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was</code></pre>

<p>Example output: 
 <pre class="highlight"><code> Using default tag: latest
 The push refers to repository [default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was]
 470e7d3b0bec: Pushed 
 c38e61da8211: Pushed 
 2a72e88fe5eb: Pushed 
 334c79ff1b2e: Pushed 
 ccf8ea26529f: Pushed 
 af0f17433f77: Pushed 
 4254aef2aa12: Pushed 
 855301ffdcce: Pushed 
 ea252e2474a5: Pushed 
 68a4c9686496: Pushed 
 87ecb86bc8e5: Pushed 
 066b59214d49: Pushed 
 211f972e9c63: Pushed 
 b93eee2b1ddb: Pushed 
 a6ab5ae423d9: Pushed 
 3f785cf0a0ae: Pushed 
 latest: digest: sha256:4f4e8ae82fa22c83febc4f884b5026d01815fc704df6196431db8ed7a7def6a0 size: 3672</code></pre></p>
</li>
<li>
<p>Verify that the image is in the image registry. The following command will get the images in the registry. Filter through the results to get only the image you pushed. Run the following command:</p>
</li>
</ul>
<pre class="highlight"><code>oc get images | grep apps-was/cos-was</code></pre>

<ul>
<li>
<p>The application image you just pushed should be listed. The hash of the image is stored alongside (indicated by the SHA-256 value).</p>
<p>Example output:
 <pre class="highlight"><code>image-registry.openshift-image-registry.svc:5000/apps-was/cos-was@sha256:bc072d3b78ae6adcd843af75552965e5ed863bcce4fc3f1bc5d194570bc16953</code></pre></p>
</li>
<li>
<p>OpenShift uses <em>ImageStream</em> to provide an abstraction for referencing container images from within the cluster. When an image is pushed to registry, an <em>ImageStream</em> is created automatically, if one doesn't already exist. Run the following command to see the <em>ImageStream</em> that's created:</p>
</li>
</ul>
<pre class="highlight"><code>oc get imagestreams -n apps-was</code></pre>

<p>Example output:
     ```
    NAME      IMAGE REPOSITORY                                                              TAGS      UPDATED         <br />
    cos-was   default-route-openshift-image-registry.apps.demo.ibmdte.net/apps-was/cos-was  latest    2 minutes ago         </p>
<pre><code> ```
</code></pre>
<ul>
<li>
<p>You can also use the OpenShift console (UI) to see the <em>ImageStream</em>:</p>
<ul>
<li>From the panel on left-side, click on <strong>Builds</strong> &gt; <strong>Image Streams</strong>. </li>
<li>Then select <code>apps-was</code> from the <strong>Project</strong> drop-down menu. </li>
<li>
<p>Click on <code>cos-was</code> from the list. </p>
<p><img alt="imagestream1" src="extras/images/buildimage1.png" /></p>
</li>
<li>
<p>Scroll down to the bottom to see the image that you pushed.</p>
<p><img alt="imagestream2" src="extras/images/buildimage2.png" /> </p>
</li>
</ul>
</li>
</ul>
<p><a name="deploy"></a></p>
<h2 id="deploy-without-operator">Deploy without operator</h2>
<p>The following steps will deploy the modernized Customer Order Services application in a traditional WebSphere Base container to a RedHat OpenShift cluster.</p>
<p>Customer Order Services application uses DB2 as its database. 
You can connect to an on-prem database that already exists or migrate the database to cloud. 
Since migrating the database is not the focus of this particular workshop and to save time, the database needed by the application is already configured in the OpenShift cluster you are using.</p>
<h3 id="deploy-application-without-operator-hands-on">Deploy application without operator (Hands-on)</h3>
<ol>
<li>Run the following command to deploy the resources (*.yaml files) in the <code>deploy</code> directory:</li>
</ol>
<p><pre class="highlight"><code>oc apply -f deploy</code></pre>
   Output:
   <pre class="highlight"><code>deployment.apps/cos-was created
route.route.openshift.io/cos-was created
secret/authdata created
service/cos-was created </code></pre></p>
<ol>
<li>Let's review what we just did. </li>
<li>
<p>The directory <code>deploy</code> contains the following yaml files:</p>
<ul>
<li><code>Deployment.yaml</code>:  the specification for creating a Kubernetes deployment</li>
<li><code>Service.yaml</code>: the specification to expose the deployment as a cluster-wide Kubernetes service.</li>
<li><code>Route.yaml</code>: the specification to expose the service as a route visible outside of the cluster.</li>
<li><code>Secret.yaml</code>: the specification that the <code>properties based configuration</code> properties file used to configure database user/password when the container starts.</li>
</ul>
</li>
<li>
<p>The file <code>Deployment.yaml</code> looks like:</p>
<pre class="highlight"><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: cos-was
  namespace: apps-was
spec:
  selector:
    matchLabels:
      app: cos-was
  replicas: 1
  template:
    metadata:
      labels:
        app: cos-was
    spec:
      containers:
      - name: cos-was
        image: image-registry.openshift-image-registry.svc:5000/apps-was/cos-was
        ports:
          - containerPort: 9080
        livenessProbe:
          httpGet:
            path: /CustomerOrderServicesWeb/index.html
            port: 9080
          periodSeconds: 30
          failureThreshold: 6
          initialDelaySeconds: 90
        readinessProbe:
          httpGet:
            path: /CustomerOrderServicesWeb/index.html
            port: 9080
          periodSeconds: 10
          failureThreshold: 3
        volumeMounts:
        - mountPath: /etc/websphere
          name: authdata
          readOnly: true
      volumes:
      - name: authdata
        secret:
            secretName: authdata</code></pre>

<ul>
<li>Note:</li>
<li>The liveness probe is used to tell Kubernetes when the application is live. Due to the size of the traditional WAS image, the initialDelaySeconds attribute has been set to 90 seconds to give the container time to start.</li>
<li>The readiness probe is used to tell Kubernetes whether the application is ready to serve requests. </li>
<li>You may store property file based configuration files such as configmaps and secrets, and bind their contents into the <code>/etc/websphere</code> directory. </li>
<li>When the container starts, the server startup script will apply all the property files found in the <code>/etc/websphere</code> directory to reconfigure the server.</li>
<li>For our example, the <code>volumeMounts</code> and <code>volumes</code> are used to bind the contents of the secret <code>authdata</code> into the directory <code>/etc/websphere</code> during container startup. </li>
<li>After it is bound, it will appear as the file <code>/etc/websphere/authdata.properties</code>. <ul>
<li>For volumeMounts:</li>
<li>The mountPath, <code>/etc/websphere</code>, specifies the directory where the files are bound.</li>
<li>the name, <code>authdata</code>, specifies the name of the volume</li>
<li>For volumes:</li>
<li>the secretName specifies the name of the secret whose contents are to be bound.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The file <code>Secret.yaml</code> looks like:</p>
<pre class="highlight"><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: authdata
  namespace: apps-was
type: Opaque
stringData:
  authdata.props: |-
    #
    # Configuration properties file for cells/DefaultCell01|security.xml#JAASAuthData_1597094577206#
    # Extracted on Tue Aug 11 15:30:36 UTC 2020
    #

    #
    # Section 1.0 ## Cell=!{cellName}:Security=:JAASAuthData=alias#DBUser
    #

    #
    # SubSection 1.0.0 # JAASAuthData Section
    #
    ResourceType=JAASAuthData
    ImplementingResourceType=GenericType
    ResourceId=Cell=!{cellName}:Security=:JAASAuthData=alias#DBUser
    AttributeInfo=authDataEntries
    #

    #
    #Properties
    #
    password="{xor}Oz1tNjEsK24=" #required
    alias=DBUser #required
    userId=db2inst1 #required
    description=

    #
    # End of Section 1.0# Cell=!{cellName}:Security=:JAASAuthData=alias#DBUser
    #
    #
    #
    EnvironmentVariablesSection
    #
    #
    #Environment Variables
    cellName=DefaultCell01</code></pre>

<ul>
<li>The attribute <code>authdata.properties</code> contains the properties file based configure used to update the database userId and password for the JAASAuthData whose alias is DBUser. </li>
<li>The configuration in Deployment.yaml maps it as the file <code>/etc/websphere/authdata.properties</code> during container startup so that the application server startup script can automatically configure the server with these entries. </li>
</ul>
</li>
</ol>
<p><a name="access-the-application"></a></p>
<h2 id="access-the-application-without-operator-hands-on">Access the application without operator (Hands-on)</h2>
<ol>
<li>Confirm you're at the current project <code>apps-was</code>:
   <pre class="highlight"><code>oc project</code></pre></li>
</ol>
<p>Example output:
   <pre class="highlight"><code>Using project "apps-was" on server "https://c114-e.us-south.containers.cloud.ibm.com:30016".</code></pre>
   - If it's not at the project <code>apps-was</code>, then switch:
     <pre class="highlight"><code>oc project apps-was</code></pre>
1. Run the following command to verify the pod is running:
   <pre class="highlight"><code>oc get pod</code></pre>
   If the status does not show <code>1/1</code> READY, wait a while, checking status periodically:
   <pre class="highlight"><code>NAME                       READY   STATUS    RESTARTS   AGE
cos-was-6bd4767bf6-xhr92   1/1     Running   0          120m</code></pre></p>
<ol>
<li>Run the following command to get the URL of your application (the route URL plus the application contextroot): 
   <pre class="highlight"><code>echo http://$(oc get route cos-was  --template='{{ .spec.host }}')/CustomerOrderServicesWeb</code></pre></li>
</ol>
<p>Example output:
   <pre class="highlight"><code>http://cos-was-apps-was.apps.demo.ibmdte.net/CustomerOrderServicesWeb</code></pre></p>
<ol>
<li>
<p>Return to your Firefox browser window and go to the URL outputted by the command run in the previous step.</p>
</li>
<li>
<p>You will be prompted to login in order to access the application. Enter the following credentials:</p>
<ul>
<li>Username: <strong>skywalker</strong></li>
<li>Password: <strong>force</strong></li>
</ul>
<p><img alt="accessapplication1" src="extras/images/accessapplication1.png" /></p>
</li>
<li>
<p>After login, the application page titled <em>Electronic and Movie Depot</em> will be displayed. From the <code>Shop</code> tab, click on an item (a movie) and on the next pop-up panel, drag and drop the item into the shopping cart. </p>
<p><img alt="accessapplication2" src="extras/images/accessapplication2.png" /></p>
</li>
<li>
<p>Add a few items to the cart. As the items are added, they’ll be shown under <em>Current Shopping Cart</em> (on the upper right) with <em>Order Total</em>.</p>
<p><img alt="accessapplication3" src="extras/images/accessapplication3.png" /></p>
</li>
<li>
<p>Close the browser.</p>
</li>
</ol>
<h3 id="review-the-application-workload-flow-without-operator-hands-on">Review the application workload flow without operator (Hands-on)</h3>
<ol>
<li>Below is an overview diagram on the deployment you've completed from the above steps: </li>
<li>Note: DB2 in the middle of the diagram is pre-installed through a different project <code>db</code> and has been up and running before your hands-on.  Also it will not be impacted when you're removing the deployment in next step.</li>
</ol>
<p><img alt="application flow with standard deployment" src="extras/images/app-flowchart_1.jpg" /></p>
<ol>
<li>
<p>Return to the Firefox browser and open the OpenShift Console to view the resources on the deployment.</p>
</li>
<li>
<p>View the resources in the project <code>apps-was</code>:</p>
<ul>
<li>Select the <code>apps-was</code> project from the project drop down menu.</li>
<li>View <code>deployment</code> details:</li>
<li>
<p>Click on the <strong>Deployments</strong> tab under <strong>Workloads</strong> from the left menu and select <code>cos-was</code></p>
<p><img alt="app-was deployment1" src="extras/images/workload-deploy1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml</p>
<p><img alt="app-was deployment2" src="extras/images/workload-deploy2.jpg" /></p>
</li>
<li>
<p>View <code>pod</code> details:</p>
</li>
<li>
<p>Click on the <strong>Pods</strong> tab under <strong>Workloads</strong> from the left menu and select the pod with name starting with <code>cos-was</code></p>
<p><img alt="app-was pod1" src="extras/images/workload-pod1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>Logs</code> tab to view the WebSphere Application Server log</p>
<p><img alt="app-was pod3" src="extras/images/workload-pod3.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>Terminal</code> tab to view the files inside the container</p>
<p><img alt="app-was pod4" src="extras/images/workload-pod4.jpg" /></p>
<p><img alt="app-was pod5" src="extras/images/workload-pod5.jpg" /></p>
</li>
<li>
<p>View <code>secret</code> details:</p>
</li>
<li>
<p>Click on the <strong>Secrets</strong> tab under <strong>Workloads</strong> from the left menu and select the <code>authdata</code> secret.</p>
<p><img alt="app-was secret1" src="extras/images/workload-secret1.jpg" /></p>
</li>
<li>
<p>Scroll down to the <strong>Data</strong> section and click on the copy icon to view the content.</p>
<p><img alt="app-was secret2" src="extras/images/workload-secret2.jpg" /></p>
</li>
<li>
<p>View <code>service</code> details:</p>
</li>
<li>
<p>Click on the <strong>Services</strong> tab under <strong>Networking</strong> from the left menu and select the <code>cos-was</code> service.</p>
<p><img alt="service" src="extras/images/reviewapplication1.png" /></p>
</li>
<li>
<p>Review service information including address and port mapping details.</p>
<p><img alt="app-was service" src="extras/images/network-service.jpg" /></p>
</li>
<li>
<p>View <code>route</code> details:</p>
</li>
<li>
<p>Click on the <strong>Routes</strong> tab under <strong>Networking</strong> from the left menu and select the <code>cos-was</code> route.</p>
<p><img alt="app-was route" src="extras/images/network-route.jpg" /></p>
</li>
</ul>
<p><a name="db project resource"></a>
  1. View the resources in the project <code>db</code>:
 - Select the <code>db</code> project from the project drop down menu.</p>
<ul>
<li>View <code>deployment</code> details:   </li>
<li>
<p>Click on the <strong>Deployments</strong> tab under <strong>Workloads</strong> from the left menu and select <code>cos-db-was</code></p>
<p><img alt="db deploy1" src="extras/images/db_deploy_1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml</p>
<p><img alt="db deploy2" src="extras/images/db_deploy_2.jpg" /></p>
</li>
<li>
<p>View <code>pod</code> details:</p>
</li>
<li>
<p>Click on the <strong>Pods</strong> tab under <strong>Workloads</strong> from the left menu and select the pod with name starting with <code>cos-db-was</code></p>
<p><img alt="db pod1" src="extras/images/db_pod_1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>Logs</code> tab to view the database logs</p>
</li>
<li>
<p>Navigate to the <code>Terminal</code> tab to view the files in the database container</p>
<p><img alt="db pod2" src="extras/images/db_pod_2.jpg" /></p>
</li>
<li>
<p>View <code>service</code> details:</p>
</li>
<li>
<p>Click on the <strong>Services</strong> tab under <strong>Networking</strong> from the left menu and select the <code>cos-db-was</code> service.</p>
<p><img alt="db service1" src="extras/images/db_net_service_1.jpg" /></p>
<p><img alt="db service2" src="extras/images/db_net_service_2.jpg" /></p>
</li>
</ul>
</li>
</ol>
<h2 id="remove-your-deployment-standard-deployment-without-operator-hands-on">Remove your deployment (standard deployment without operator) (Hands-on)</h2>
<p>To remove the deploment from the above scenario without the operator, run the command:</p>
<blockquote>
<p>Note: The pre-installed resources such as DB2, are not removed.</p>
</blockquote>
<pre class="highlight"><code>oc delete -f deploy</code></pre>

<p>Output:
<pre class="highlight"><code>deployment.apps "cos-was" deleted
route.route.openshift.io "cos-was" deleted
secret "authdata" deleted
service "cos-was" deleted</code></pre></p>
<p><a name="deploy-rco"></a></p>
<h2 id="alternate-deployment-via-runtime-component-operator">Alternate Deployment Via Runtime Component Operator</h2>
<p>Another way to deploy the application is via the Runtime Component Operator. It is a generic operator used to deploy different types of application images. The operator has already been installed into your environment. For more information, see: https://github.com/application-stacks/runtime-component-operator</p>
<h3 id="deploy-application-via-runtime-component-operator-hands-on">Deploy application (via Runtime Component Operator) (Hands-on)</h3>
<ol>
<li>Run the following command which uses the Runtime Component Operator to deploy the same Customer Order Service application image:
   <pre class="highlight"><code>oc apply -f deploy-rco</code></pre></li>
</ol>
<p>Output:
   <pre class="highlight"><code>runtimecomponent.app.stacks/cos-was-rco created
secret/authdata-rco created</code></pre></p>
<ol>
<li>Let's review what we just did. </li>
<li>
<p>First, list the contents of the <code>deploy-rco</code> directory:</p>
<pre class="highlight"><code>ls deploy-rco</code></pre>

<p>The output shows there are only two yaml files:
 <pre class="highlight"><code>RuntimeComponent.yaml  Secret.yaml</code></pre></p>
</li>
<li>
<p>Review Secret.yaml: 
     <pre class="highlight"><code>cat deploy-rco/Secret.yaml</code></pre></p>
<ul>
<li>Note that it is the same as the <code>Secret.yaml</code> in the <code>deploy</code> directory, except the name has been changed to <code>authdata-rco</code>.  </li>
<li>
<p>It serves the same purpose for this new deployment - to override the database user/password.</p>
</li>
<li>
<p>Review RuntimeComponent.yaml:
  <pre class="highlight"><code>cat deploy-rco/RuntimeComponent.yaml</code></pre></p>
</li>
</ul>
<p>And the output:</p>
<pre class="highlight"><code class="language-yaml">apiVersion: app.stacks/v1beta1
kind: RuntimeComponent
metadata:
  name: cos-was-rco
  namespace: apps-was
spec:
  applicationImage: image-registry.openshift-image-registry.svc:5000/apps-was/cos-was
  service:
    port: 9080
  readinessProbe:
    httpGet:
      path: /CustomerOrderServicesWeb/index.html
      port: 9080
    periodSeconds: 10
    failureThreshold: 3
  livenessProbe:
    httpGet:
      path: /CustomerOrderServicesWeb/index.html
      port: 9080
    periodSeconds: 30
    failureThreshold: 6
    initialDelaySeconds: 90
  expose: true
  route:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  volumeMounts:
    - mountPath: /etc/websphere
      name: authdata-rco
      readOnly: true
  volumes:
    - name: authdata-rco
      secret:
          secretName: authdata-rco</code></pre>

<p>Note that:
  - The kind is <code>RuntimeComponent</code>
  - The <code>expose</code> attribute is set to <code>true</code> to expose a route
  - The attributes within the yaml file are essentially the same information that you provided for the <code>Service</code>, <code>Route</code>, and <code>Deployment</code> resources in the <code>deploy</code> directory.
  - The controller for the RuntimeComponent custom resource reacts to changes in the above specification, and creates the corresponding <code>Service</code>, <code>Route</code>, and <code>Deployment</code> objects. Issue the following commands to view what the controller has created:</p>
<pre><code> ```
 oc get Deployment cos-was-rco -o yaml
 oc get Service cos-was-rco -o yaml
 oc get Route cos-was-rco -o yaml
 ```
</code></pre>
</li>
</ol>
<h2 id="access-the-application-via-runtime-component-operator-hands-on">Access the application (via Runtime Component Operator) (Hands-on)</h2>
<ol>
<li>Confirm you're at the current project <code>apps-was</code>:
   <pre class="highlight"><code>oc project</code></pre></li>
</ol>
<p>Example output:
   <pre class="highlight"><code>Using project "apps-was" on server "https://c114-e.us-south.containers.cloud.ibm.com:30016".</code></pre>
   - If it's not at the project <code>apps-was</code>, then switch:
     <pre class="highlight"><code>oc project apps-was</code></pre>
1. Run the following command to verify the pod is running:
   <pre class="highlight"><code>oc get pod</code></pre></p>
<p>If the status does not show <code>1/1</code> READY, wait a while, checking status periodically. Note the prefix name for the pod is <code>cos-was-rco</code>.
   <pre class="highlight"><code>NAME                           READY   STATUS    RESTARTS   AGE
cos-was-rco-6779784fc8-pz92m   1/1     Running   0          2m59s</code></pre></p>
<ol>
<li>Run the following command to get the URL of your application (the route URL plus the application contextroot): </li>
</ol>
<pre class="highlight"><code>echo http://$(oc get route cos-was-rco  --template='{{ .spec.host }}')/CustomerOrderServicesWeb</code></pre>

<p>Example output:
   <pre class="highlight"><code>http://cos-was-rco-apps-was.apps.demo.ibmdte.net/CustomerOrderServicesWeb</code></pre></p>
<ol>
<li>
<p>Return to your Firefox browser window and go to the URL outputted by the command run in the previous step. The steps to access the application are the same as those used when deploying without the operator.</p>
</li>
<li>
<p>You will be prompted to login in order to access the application. Enter the following credentials:</p>
<ul>
<li>Username: <strong>skywalker</strong></li>
<li>Password: <strong>force</strong></li>
</ul>
<p><img alt="withoutoperator1" src="extras/images/withoutoperator1.png" /></p>
</li>
<li>
<p>After login, the application page titled <em>Electronic and Movie Depot</em> will be displayed. From the <code>Shop</code> tab, click on an item (a movie) and on the next pop-up panel, drag and drop the item into the shopping cart. </p>
<p><img alt="accessapplication2" src="extras/images/accessapplication2.png" /></p>
</li>
<li>
<p>Add a few items to the cart. As the items are added, they’ll be shown under <em>Current Shopping Cart</em> (on the upper right) with <em>Order Total</em>.</p>
<p><img alt="accessapplication3" src="extras/images/accessapplication3.png" /></p>
</li>
<li>
<p>Close the browser.</p>
</li>
</ol>
<h3 id="review-the-application-workload-flow-with-runtime-component-operator-hands-on">Review the application workload flow with Runtime Component Operator (Hands-on)</h3>
<ol>
<li>Below is an overview diagram on the deployment you've completed from the above steps using Runtime Component Operator: </li>
<li>Note: DB2 in the middle of the diagram is pre-installed through a different project <code>db</code> and has been up and running before your hands-on.</li>
</ol>
<p><img alt="applicaiton flow with runtime component operator deployment" src="extras/images/app-flowchart_2.jpg" /></p>
<ol>
<li>
<p>Return to the Firefox browser and open the OpenShift Console to view the resources on the deployment.</p>
</li>
<li>
<p>View the resources in the project <code>openshift-operators</code>:</p>
<ul>
<li>Select the <code>openshift-operators</code> project from the project drop down menu.</li>
<li>View operator <code>deployment</code> details:</li>
<li>
<p>Click on the <strong>Deployments</strong> tab under <strong>Workloads</strong> from the left menu and select <code>runtime-component-operator</code></p>
<p><img alt="rco deploy1" src="extras/images/rco-deploy1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml</p>
<p><img alt="rco deploy2" src="extras/images/rco-deploy2.jpg" /></p>
</li>
<li>
<p>View operator <code>pod</code> details:</p>
</li>
<li>
<p>Click on the <strong>Pods</strong> tab under <strong>Workloads</strong> from the left menu and select the pod with name starting with <code>runtime-component-operator</code></p>
<p><img alt="rco pod1" src="extras/images/rco-pod1.jpg" /></p>
</li>
<li>
<p>Navigate to <code>Logs</code> to view the runtime-component-operator container log</p>
<p><img alt="rco pod2" src="extras/images/rco-pod2.jpg" /></p>
</li>
<li>
<p>Navigate to <code>Terminal</code> to view the files in the container</p>
<p><img alt="rco pod3" src="extras/images/rco-pod3.jpg" /></p>
</li>
</ul>
</li>
<li>
<p>View the resources in the project <code>apps-was</code>:</p>
<ul>
<li>
<p>Select the <code>apps-was</code> project from the project drop down menu.</p>
</li>
<li>
<p>View <code>Runtime Component</code> instance details:</p>
</li>
<li>
<p>Click on the <strong>Installed Operators</strong> tab under <strong>Operators</strong> from the left menu and select <code>Runtime Component Operator</code>.<br />
      &gt; Note: The operator is installed at cluster level and is visible to all existing projects, but Runtime Component instance is created under the project <code>apps-was</code>.</p>
<p><img alt="rco op1" src="extras/images/rco-op1.jpg" /></p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml</p>
<p><img alt="rco op2" src="extras/images/rco-op2.jpg" /></p>
</li>
<li>
<p>Navigate to the<code>Runtime Component</code> tab and select <code>cos-was-rco</code> to view the deails of Runtime Component instance</p>
<p><img alt="rco op3" src="extras/images/rco-op3.jpg" /></p>
</li>
<li>
<p>View <code>deployment</code> details:</p>
</li>
<li>
<p>Click on the <strong>Deployments</strong> tab under <strong>Workloads</strong> from the left menu and select <code>cos-was-rco</code>.</p>
<p><img alt="rc workload deploy1" src="extras/images/rc-workload-deploy1.jpg" />  </p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml.  <br />
      &gt; Note the deployment is created through the controller of RuntimeComponent custom resource.</p>
<p><img alt="rc workload deploy2" src="extras/images/rc-workload-deploy2.jpg" /></p>
</li>
<li>
<p>View <code>pod</code> details:    </p>
</li>
<li>
<p>Click on the <strong>Pods</strong> tab under <strong>Workloads</strong> from the left menu and select the pod starting with <code>cos-was-rco</code></p>
<p><img alt="rc workload pod1" src="extras/images/rc-workload-pod1.jpg" />  </p>
</li>
<li>
<p>Navigate to the <code>Logs</code> tab to view the WebSphere Application Server log</p>
<p><img alt="rc workload pod2" src="extras/images/rc-workload-pod2.jpg" />  </p>
</li>
<li>
<p>View <code>service</code> details:</p>
</li>
<li>
<p>Click on the <strong>Services</strong> tab under <strong>Networking</strong> from the left menu and select <code>cos-was-rco</code></p>
<p><img alt="rc network service1" src="extras/images/rc-net-service1.jpg" /> </p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml.  <br />
      &gt; Note the service is created through the controller of RuntimeComponent custom resource.</p>
<p><img alt="rc network service2" src="extras/images/rc-net-service2.jpg" /> </p>
</li>
<li>
<p>View <code>route</code> details:</p>
</li>
<li>
<p>Click on the <strong>Routes</strong> tab under <strong>Networking</strong> from the left menu and select <code>cos-was-rco</code></p>
<p><img alt="rc network route1" src="extras/images/rc-net-route1.jpg" /> </p>
</li>
<li>
<p>Navigate to the <code>YAML</code> tab to view the content of yaml.<br />
      &gt; Note the route is created through the controller of RuntimeComponent custom resource.</p>
<p><img alt="rc network route2" src="extras/images/rc-net-route2.jpg" />   </p>
</li>
<li>
<p>View <code>secret</code> details:</p>
<ul>
<li>Click on the <strong>Secrets</strong> tab under <strong>Workloads</strong> from the left menu and select <code>authdata-rco</code></li>
</ul>
<p><img alt="rc workload secret1" src="extras/images/rc-workload-secret1.jpg" /> </p>
</li>
</ul>
</li>
<li>
<p>Resources in the project <code>db</code>: </p>
<ul>
<li>Same information as listed in the section above in <strong>Review the application workload flow without operator</strong>.</li>
</ul>
</li>
</ol>
<h2 id="cleanup-the-deployment-with-runtime-component-operator-hands-on">Cleanup (the deployment with Runtime Component Operator) (Hands-on)</h2>
<ol>
<li>Run the following command in a terminal window to remove the deployment from the above secenario with Runtime Component instance:</li>
<li>
<p>Note: The pre-installed resources such as Runtime Component Operator, DB2, are not removed.</p>
<pre class="highlight"><code>oc delete -f deploy-rco</code></pre>

<p>Output:
 <pre class="highlight"><code>runtimecomponent.app.stacks "cos-was-rco" deleted
secret "authdata-rco" deleted</code></pre></p>
</li>
<li>
<p>Verify that the corresponding application <code>Service</code>, <code>Route</code>, and <code>Deployment</code> have also been deleted:</p>
</li>
</ol>
<pre class="highlight"><code>oc get Deployment 
oc get Service 
oc get Route </code></pre>

<p>Output from each <code>get</code> command above should be:
   <pre class="highlight"><code>No resources found in apps-was namespace.</code></pre></p>
<p><a name="summary"></a></p>
<h2 id="summary">Summary</h2>
<p>Congratulations! You've completed the <strong>Operational Modernization</strong> lab. You containerized and deployed a monolith application to cloud!</p>
<p><a name="next"></a></p>
<h2 id="next">Next</h2>
<p>Please follow the link to the next lab <strong>Runtime Modernization</strong>:
- <a href="../RuntimeModernization">Runtime Modernization</a></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>

<!--
MkDocs version : 1.0.4
Build Date UTC : 2021-08-25 12:47:03
-->
